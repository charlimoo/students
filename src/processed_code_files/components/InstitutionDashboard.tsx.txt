// start of components/InstitutionDashboard.tsx
import React from 'react';
import { Button } from './ui/button';
import { Card, CardContent, CardHeader, CardTitle } from './ui/card';
import { Badge } from './ui/badge';
import { Progress } from './ui/progress';
import { 
  Users, 
  FileText, 
  Clock, 
  CheckCircle, 
  AlertCircle,
  TrendingUp,
  Eye,
  BarChart3,
  UserPlus
} from 'lucide-react';

interface InstitutionDashboardProps {
  onNavigate: (page: string, applicationId?: string) => void;
}

export function InstitutionDashboard({ onNavigate }: InstitutionDashboardProps) {

  const applicants = [
    { id: 'APL-2024-001', name: 'علی محمدی', program: 'مهندسی کامپیوتر', status: 'در حال بررسی', statusType: 'pending', progress: 65 },
    { id: 'APL-2024-002', name: 'فاطمه احمدی', program: 'مدیریت بازرگانی', status: 'تایید شده', statusType: 'approved', progress: 100 },
    { id: 'APL-2024-003', name: 'محمد رضایی', program: 'مهندسی برق', status: 'نیاز به بررسی', statusType: 'review', progress: 25 }
  ];

  const stats = {
    totalApplicants: 156,
    pendingReview: 23,
    approved: 89,
    requiresAction: 12
  };
  
  const getStatusBadgeClass = (statusType: string) => {
    switch (statusType) {
      case 'approved': return 'status-badge-approved';
      case 'pending': return 'status-badge-pending';
      case 'review': return 'status-badge-review';
      default: return 'bg-muted';
    }
  };

  return (
    <div className="flex-1 overflow-auto p-8" dir="rtl">
        <div className="flex items-center justify-between mb-8">
            <div>
                <h1 className="text-3xl persian-heading text-foreground">داشبورد موسسه</h1>
                <p className="text-muted-foreground">خوش آمدید! خلاصه وضعیت متقاضیان شما در اینجا آمده است.</p>
            </div>
            <Button className="flex items-center space-x-2 space-x-reverse" onClick={() => onNavigate('new-application-form')}>
                <UserPlus className="w-4 h-4" />
                <span>ثبت درخواست جدید</span>
            </Button>
        </div>
        
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <Card className="card-modern">
                <CardContent className="p-6">
                    <div className="flex items-center space-x-3 space-x-reverse">
                        <div className="w-12 h-12 bg-primary/10 rounded-xl flex items-center justify-center"><Users className="w-6 h-6 text-primary" /></div>
                        <div><p className="text-2xl font-bold">{stats.totalApplicants}</p><p className="text-sm text-muted-foreground">کل متقاضیان</p></div>
                    </div>
                </CardContent>
            </Card>
            <Card className="card-modern">
                <CardContent className="p-6">
                    <div className="flex items-center space-x-3 space-x-reverse">
                        <div className="w-12 h-12 bg-warning/10 rounded-xl flex items-center justify-center"><Clock className="w-6 h-6 text-warning" /></div>
                        <div><p className="text-2xl font-bold">{stats.pendingReview}</p><p className="text-sm text-muted-foreground">در انتظار بررسی</p></div>
                    </div>
                </CardContent>
            </Card>
            <Card className="card-modern">
                <CardContent className="p-6">
                    <div className="flex items-center space-x-3 space-x-reverse">
                        <div className="w-12 h-12 bg-success/10 rounded-xl flex items-center justify-center"><CheckCircle className="w-6 h-6 text-success" /></div>
                        <div><p className="text-2xl font-bold">{stats.approved}</p><p className="text-sm text-muted-foreground">پذیرفته شده</p></div>
                    </div>
                </CardContent>
            </Card>
            <Card className="card-modern">
                <CardContent className="p-6">
                    <div className="flex items-center space-x-3 space-x-reverse">
                        <div className="w-12 h-12 bg-destructive/10 rounded-xl flex items-center justify-center"><AlertCircle className="w-6 h-6 text-destructive" /></div>
                        <div><p className="text-2xl font-bold">{stats.requiresAction}</p><p className="text-sm text-muted-foreground">نیاز به اقدام</p></div>
                    </div>
                </CardContent>
            </Card>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div className="lg:col-span-2">
                <Card className="card-modern">
                    <CardHeader>
                        <div className="flex items-center justify-between">
                            <CardTitle className="persian-heading">متقاضیان اخیر</CardTitle>
                            <Button variant="outline" size="sm" onClick={() => onNavigate('my-applicants')}>مشاهده همه</Button>
                        </div>
                    </CardHeader>
                    <CardContent className="space-y-4">
                        {applicants.map((applicant) => (
                            <div key={applicant.id} className="flex items-center justify-between p-4 border rounded-lg">
                                <div>
                                    <p className="font-medium">{applicant.name}</p>
                                    <p className="text-sm text-muted-foreground">{applicant.program}</p>
                                    <div className="flex items-center space-x-2 space-x-reverse mt-2"><Progress value={applicant.progress} className="w-32 h-2" /><span className="text-xs text-muted-foreground">{applicant.progress}%</span></div>
                                </div>
                                <div className="flex items-center space-x-3 space-x-reverse">
                                    <Badge className={getStatusBadgeClass(applicant.statusType)}>{applicant.status}</Badge>
                                    <Button 
                                        variant="ghost" 
                                        size="sm"
                                        // FIX: Corrected navigation call to 'applicant-detail'
                                        onClick={() => onNavigate('applicant-detail', applicant.id)}
                                        className="mr-2"
                                    >
                                        <Eye className="w-4 h-4" />
                                    </Button>
                                </div>
                            </div>
                        ))}
                    </CardContent>
                </Card>
            </div>
            
            <div className="space-y-6">
                 <Card className="card-modern">
                     <CardHeader><CardTitle className="persian-heading">آمار سریع</CardTitle></CardHeader>
                     <CardContent className="space-y-4">
                        <div className="flex justify-between items-center"><span className="text-sm text-muted-foreground">نرخ موفقیت</span><span className="font-bold text-success flex items-center">78% <TrendingUp className="w-4 h-4 mr-1"/></span></div>
                        <div className="flex justify-between items-center"><span className="text-sm text-muted-foreground">میانگین زمان بررسی</span><span className="font-bold">۱۲ روز</span></div>
                     </CardContent>
                 </Card>
                 <Card className="card-modern">
                    <CardHeader><CardTitle className="persian-heading">گزارشات</CardTitle></CardHeader>
                    <CardContent>
                        <Button className="w-full" onClick={() => onNavigate('institution-reports')}>
                            <BarChart3 className="w-4 h-4 ml-2" />
                            مشاهده گزارشات کامل
                        </Button>
                    </CardContent>
                 </Card>
            </div>
        </div>
      </div>
  );
}
// end of components/InstitutionDashboard.tsx